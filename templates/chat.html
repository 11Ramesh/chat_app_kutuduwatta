<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Kurudhuwatta Stores</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='chat.css') }}">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #83aff27e;
    }

   

    .chat-header {
      position: relative;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      padding: 10px;
      
    }

    /* Three-dot menu button */
    .menu-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 24px;
      cursor: pointer;
      user-select: none;
    }

    /* Dropdown menu */
    .dropdown-menu {
      display: none;
      position: absolute;
      top: 35px;
      right: 10px;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      z-index: 100;
      min-width: 100px;
    }

    .dropdown-menu a {
      display: block;
      padding: 8px 12px;
      text-decoration: none;
      color: #007bff;
      font-size: 14px;
    }

    .dropdown-menu a:hover {
      background-color: #f0f0f0;
    }



    form {
      display: flex;
      gap: 5px;
      margin-top: 10px;
    }

    input[type="text"] {
      flex: 1;
      padding: 8px;
      font-size: 14px;
    }

    button {
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="chat-container">
    <div class="chat-header">
      Kurudhuwatta Stores
      <span class="menu-btn" id="menuBtn">&#8942;</span> <!-- Three-dot icon -->
      <div class="dropdown-menu" id="dropdownMenu">
        <a href="{{ url_for('help') }}">Help</a>
        <a href="{{ url_for('logout') }}">Logout</a>
      </div>
    </div>

    <div id="chat"></div>

    <form id="chatForm" method="POST">
      <input type="text" name="user_input" id="user_input" placeholder="Type a message">
      <button type="submit">Send</button>
    </form>
  </div>

  <script>
    const menuBtn = document.getElementById('menuBtn');
    const dropdownMenu = document.getElementById('dropdownMenu');

    // Toggle menu
    menuBtn.addEventListener('click', () => {
      dropdownMenu.style.display = dropdownMenu.style.display === 'block' ? 'none' : 'block';
    });

    // Close menu if clicked outside
    window.addEventListener('click', (e) => {
      if (!menuBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
        dropdownMenu.style.display = 'none';
      }
    });

    const form = document.getElementById('chatForm');
    const chat = document.getElementById('chat');
    const userInput = document.getElementById('user_input');

    window.onload = () => {
      const aiMsgDiv = document.createElement('div');
      aiMsgDiv.classList.add('message', 'ai-msg');
      aiMsgDiv.innerHTML = `<div class="bubble ai-bubble">Welcome to Kurudhuwatta Stores! How can I help you today?</div>`;
      chat.appendChild(aiMsgDiv);
      chat.scrollTop = chat.scrollHeight;
    };

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const message = userInput.value.trim();
      if (!message) return;

      const userMsgDiv = document.createElement('div');
      userMsgDiv.classList.add('message', 'user-msg');
      userMsgDiv.innerHTML = `<div class="bubble user-bubble">${message}</div>`;
      chat.appendChild(userMsgDiv);

      userInput.value = '';
      chat.scrollTop = chat.scrollHeight;

      const aiMsgDiv = document.createElement('div');
      aiMsgDiv.classList.add('message', 'ai-msg');
      aiMsgDiv.innerHTML = `<div class="bubble ai-bubble"><div class="typing-dots"><span></span><span></span><span></span></div></div>`;
      chat.appendChild(aiMsgDiv);
      chat.scrollTop = chat.scrollHeight;

      try {
        const response = await fetch('/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ user_input: message })
        });
        const data = await response.json();
        const aiText = data.user_output.replace(/\n/g, '<br>');

        aiMsgDiv.querySelector('.bubble').innerHTML = aiText;
        chat.scrollTop = chat.scrollHeight;
      } catch (err) {
        aiMsgDiv.querySelector('.bubble').innerHTML = 'Check your network connection';
      }
    });
  </script>

</body>
</html>
